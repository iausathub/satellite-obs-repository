{% extends "repository/base.html" %}

{% block content %}
<div class="container-fluid p-3">
    <div class="d-grid gap-3 pt-3 opacity-100" style="grid-template-columns: 2.25fr 375px;">
      <div>
        <div class="container p-3 mb-3">
        Insert explanatory text here about the purpose of the database, something about the
        dataset... Blah blah blah blah blah blah blah
        blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah
        blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah
        blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah.
        </div>
      <div class="bg-light border rounded-3 p-3">
        <div class="container">
            <h3 class="text-center">Upload Observation File</h3>
            <p class="p-3 mt-3">Insert explanatory text here about how to upload observations,
                 information about the basic data format, and a link to the full data
                 format page and possibly a sample file with the correct headers.
                 Also include what happens if the data upload fails,
                 and what kind of error messages to expect.</p>

            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="row">
                  <input type="file" class="form-control " name="uploaded_file" accept=".csv" required="required">
                </div>
                <div class="row d-inline-flex flex-row pt-3 align-items-center ">
                  <div class="col">
                    <input type="submit" class="btn btn-primary" value="Upload"
                            onclick="this.form.submit(); this.disabled=true;
                            document.getElementById('loading_spinner').hidden = false;
                            return true;" name="submit_obs">
                  </div>
                  <div class="spinner-border" id="loading_spinner" role="status" hidden>
                    <span class="visually-hidden" >Loading...</span>
                  </div>
                </div>
            </form>

          {% if error %}
            <p class="text-danger">Error: {{ error }}</a></p>
          {% endif %}

          {% if obs_id %}
          <div class="container-md bg-success border border-success rounded-3 mt-3 pt-2 "
            style="--bs-bg-opacity: .2;">
            <span class="fw-bold">Upload successful!</span>

            <p>{{ obs_id|length }} observation(s) added to the database.</p>
            <p class="mb-3">Confirmation email with observation ID(s) sent to: test@email.com</p>
            <p>Observation ID(s) with corresponding satellite name and observation date/time
              can also be downloaded as a .txt file:</p>
            <button class="btn btn-primary btn-sm mb-3" type="button"
             data-bs-toggle="collapse" data-bs-target="#collapseObsIds"
              aria-expanded="false" aria-controls="collapseObsIds">
              Download file
            </button>

            <div class="collapse" id="collapseObsIds">
              <div class="card card-body mb-2">
                <p>Observation ID(s):<br />
                  {% for id in obs_id %}
                    {% if forloop.last %}
                    {{ id }}
                    {% else %}
                    {{ id }} <br />
                    {% endif %}
                  {% endfor %}
                </p>
              </div>
            </div>

          </div>
          {% endif %}

        </div>
      </div>
      </div>
      <div class="container">
        <div class="shadow rounded-2 mb-3" style="min-height:50px;">
          <h5 class="card-title text-center bg-accent1 p-3 rounded-top-2 ">Recent observations</h5>
          <div class="card-body bg-light rounded-bottom-2 p-3">
          {% if latest_obs_list %}
            <ul>
            {% for obs in latest_obs_list %}
                <li>{{ obs.date_added }} - {{ obs.satellite_id.sat_name}}</li>
            {% endfor %}
            </ul>
          {% else %}
            <p>No observations are available.</p>
          {% endif %}
          </div>
        </div>

        <div class="shadow bg-body rounded-2 mb-3" style="min-height: 50px;">
          <h5 class="card-title text-center bg-accent1 rounded-top-3 p-3">Statistics</h5>
          <div class="card-body bg-light p-3 rounded-bottom-2">

            {% if not observation_count and not satellite_count %}
              <p>No stats are available.</p>
            {% endif %}

            {% if observation_count %}
            <span class="fs-4">{{ observation_count }}</span> observations
            <br/>
            {% endif %}

            {% if satellite_count %}
            <span class="fs-4">{{ satellite_count }}</span> satellites
            <br/>
            {% endif %}

            {% if observer_count %}
            <span class="fs-4">{{ observer_count }}</span> observers
            <br/>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}
